<!DOCTYPE html>
<html lang="fr">
<head>
            <title>Cyclopy - Django REST API #1 : Installation / API basique</title>
        <meta charset="utf-8" />

        <!-- Author -->
        <meta name="author" content="Marc-Aurele Coste">

        <!-- Foundation CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.3/dist/css/foundation.min.css" integrity="sha256-xpOKVlYXzQ3P03j397+jWFZLMBXLES3IiryeClgU5og= sha384-gP4DhqyoT9b1vaikoHi9XQ8If7UNLO73JFOOlQV1RATrA7D0O7TjJZifac6NwPps sha512-AKwIib1E+xDeXe0tCgbc9uSvPwVYl6Awj7xl0FoaPFostZHOuDQ1abnDNCYtxL/HWEnVOMrFyf91TDgLPi9pNg==" crossorigin="anonymous">

        <!-- FontAwesome -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

        <!-- Theme CSS -->
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!-- IE -->
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->






        <meta name="tags" content="Python" />
        <meta name="tags" content="Django" />
        <meta name="tags" content="REST API" />

</head>

<body id="index" class="home">

    <div class="grid-y medium-grid-frame">
        <div class="cell shrink header medium-cell-block-container">
            <!-- Topbar -->
            <div class="top-bar">

                <div class="top-bar-left">
                    <ul class="dropdown menu" data-dropdown-menu>
                        <!-- <li class="menu-text">Cyclopy</li> -->
                        <li>
                            <a class="topbar-title" href="/">Cyclopy</a>
                        </li>


                        <li>
                            <a href="/pages/about.html">A propos</a>
                            </li>

                            <li class="has-submenu">
                                <a href="#0">Catégories</a>
                                <ul class="submenu menu vertical" data-submenu>
                                    <li class="active" >
                                        <a href="/category/developpement.html">Développement</a>
                            </li>
                                    <li>
                                        <a href="/category/linux.html">Linux</a>
                            </li>
                    </ul>
                    </li>
                    </ul>
                </div>

                <div class="top-bar-right">
                </div>
            </div>
        </div>

        <div class="cell medium-auto medium-cell-block-container">
            <div class="cell medium-8 medium-cell-block-y">
                <div class="grid-x grid-padding-x">
                <div class="grid-container">
<section id="content" class="body">
    <header>
        <h2 class="entry-title">
            <a href="/django-rest-api-01.html" rel="bookmark" title="Permalink to Django REST API #1 : Installation / API basique">
                Django REST API #1 : Installation / API basique
            </a>
        </h2>

        
    </header>

    <footer class="post-info">
        <time class="published" datetime="2019-02-20T20:35:00+01:00">
            Wed 20 February 2019
        </time>

            <time class="modified" datetime="2019-02-20T20:35:00+01:00">
                Wed 20 February 2019
            </time>

            <!-- <address class="vcard author">
                By                     <a class="url fn" href="/author/marc-aurele-coste.html">Marc-Aurele Coste</a>
            </address> -->

            <div class="category">
                Category: <a href="/category/developpement.html">Développement</a>
            </div>

            <div class="tags">
                Tags:
                    <a href="/tag/python.html">Python</a>
                    <a href="/tag/django.html">Django</a>
                    <a href="/tag/rest-api.html">REST API</a>
            </div>
    </footer><!-- /.post-info -->

    <div class="entry-content">
        <p>Nous allons voir ici comment mettre en place les bases de la réalisation d'une API REST avec Django et Django REST Framework (DRF).</p>
<p>Nous verrons ici:</p>
<blockquote>
<ul class="simple">
<li>La création d'un nouveau projet Django avec Django REST Framework installé</li>
<li>La création d'un modèle</li>
<li>La création d'un sérialiser pour ce modèle</li>
<li>La création d'un viewset</li>
</ul>
</blockquote>
<div class="section" id="installation-et-creation-du-projet">
<h2>Installation et création du projet</h2>
<p>On commence par la création d'un virtualenv dans lequel on va installer Django et Django REST Framework. Lorsque l'installation est terminée on crée le projet.</p>
<div class="highlight"><pre><span></span>pip install Django djangorestframework
django-admin startproject &lt;site name&gt;
</pre></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour la suite, le nom du projet sera <strong>DjangoRestApiTutorial</strong></p>
</div>
</div>
<div class="section" id="settings">
<h2>Settings</h2>
<p>Actuellement un unique fichier de settings est présent. Nous allons le remplacer par un dossier avec le même nom et nous repartirons ensuite les settings dans plusieurs fichiers:</p>
<ul class="simple">
<li><span class="red">common.py</span> : Settings communs entre production et développement</li>
<li><span class="red">development.py</span> : Settings utilisés en développement</li>
<li><span class="red">production.py</span> : Settings utilisés en production</li>
</ul>
<div class="highlight"><pre><span></span><span class="nb">cd</span> DjangoRestApiTutorial/DjangoRestApiTutorial
mkdir settings <span class="o">&amp;&amp;</span> <span class="nb">cd</span> settings
touch __init__.py common.py development.py production.py
cat ../settings.py &gt; common.py
rm ../settings.py
</pre></div>
<p>On supprime de <span class="red">common.py</span></p>
<ul class="simple">
<li>DEBUG</li>
<li>ALLOWED_HOSTS</li>
<li>DATABASES</li>
</ul>
<p>que l'on ajoute à <span class="red">development.py</span> et <span class="red">production.py</span>.</p>
<div class="highlight"><pre><span></span><span class="c1"># development.py</span>
<span class="sd">&quot;&quot;&quot;Development settings&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Database</span>
<span class="c1"># https://docs.djangoproject.com/en/2.1/ref/settings/#databases</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># production.py</span>
<span class="sd">&quot;&quot;&quot;Production settings&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Pour finir nous ajoutons <strong>rest_framework</strong> dans la liste des <strong>INSTALLED_APPS</strong> dans note fichier <span class="red">common.py</span>. On peut maintenant lancer notre application et verifier qu'il n'y a aucune erreur.</p>
<div class="highlight"><pre><span></span>./manage.py runserver --settings<span class="o">=</span>DjangoRestApiTutorial.settings.development
</pre></div>
<p>Rendez-vous sur <a class="reference external" href="http://localhost:8000">localhost:8000</a> et vous devriez voir une page ressemblant à l'image ci-dessous.</p>
<img alt="install success" class="align-center" src="/static/images/django_rest_api/install_success.png" style="width: 949.2px; height: 486.0px;" />
<p>Les sources pour le mise en place du project sont disponibles <a class="reference external" href="https://github.com/MarcAureleCoste/DjangoRestApiTutorial/tree/S01-installation">ici</a>, branche <strong>S01-installation</strong>.</p>
</div>
<div class="section" id="creation-de-l-api">
<h2>Création de l'API</h2>
<div class="highlight"><pre><span></span><span class="c1"># Je crée un dossier dans lequel je mettrais toutes mes applications.</span>
<span class="c1"># Vous pouvez, si vous préférez, tout mettre à la racine dans ce cas la sautez les 3 lignes qui suivent.</span>
django-admin startapp apps
<span class="nb">cd</span> apps
rm -r migrations admin.py models.py tests.py views.py

django-admin startapp todo
</pre></div>
<p>Dans le fichier <span class="red">models.py</span> on va définir note modèle de Todo.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Todo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
<p>On ajoute notre nouvelle application dans les <strong>INSTALLED_APPS</strong> du fichier <span class="red">common.py</span>.</p>
<div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">#...</span>

    <span class="c1"># REST Framework</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>

    <span class="c1"># Our Todo app</span>
    <span class="s1">&#39;apps.todo&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
<p>On peut maintenant créer notre première migration pour notre application <em>todo</em> et appliquer cette migration (cela appliquera également les migrations que nous n'avons pas faite dans la première partie).</p>
<div class="highlight"><pre><span></span>./manage.py makemigrations --settings<span class="o">=</span>DjangoRestApiTutorial.settings.development
./manage.py migrate --settings<span class="o">=</span>DjangoRestApiTutorial.settings.development
</pre></div>
<p>Il nous reste trois étapes pour finir la création de notre API.</p>
<ul class="simple">
<li>Création d'un sérialiser</li>
</ul>
<p><em>serializers.py</em></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.serializers</span> <span class="kn">import</span> <span class="n">ModelSerializer</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Todo</span>

<span class="k">class</span> <span class="nc">TodoSerializer</span><span class="p">(</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Todo</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">,</span>
            <span class="s1">&#39;finished&#39;</span>
        <span class="p">)</span>
        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;read_only&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="p">}</span>
</pre></div>
<ul class="simple">
<li>Création d'un viewset</li>
</ul>
<p><em>views.py</em></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">viewsets</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Todo</span>
<span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="n">TodoSerializer</span>


<span class="c1"># Create your views here.</span>
<span class="k">class</span> <span class="nc">TodoViewset</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>

    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Todo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TodoSerializer</span>
</pre></div>
<ul class="simple">
<li>Mise en place des URLs</li>
</ul>
<p><em>urls.py</em></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.routers</span> <span class="kn">import</span> <span class="n">DefaultRouter</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">TodoViewset</span>


<span class="n">TODO_ROUTER</span> <span class="o">=</span> <span class="n">DefaultRouter</span><span class="p">()</span>
<span class="n">TODO_ROUTER</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">TodoViewset</span><span class="p">)</span>
</pre></div>
<p>Voilà pour finir nous importons ce router dans le fichier <span class="red">urls.py</span> qui se situe dans le dossier <strong>DjangoRestApiTutorial</strong> qui est notre fichier principal d'url.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="kn">from</span> <span class="nn">apps.todo.urls</span> <span class="kn">import</span> <span class="n">TODO_ROUTER</span>


<span class="n">API_URL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">TODO_ROUTER</span><span class="o">.</span><span class="n">urls</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">API_URL</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
<p>Vous pouvez maintenant vous rendre sur <cite>localhost:8000/api/todo &lt;http://localhost:8000/api/todo&gt;</cite> afin de tester votre API.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">GET /api/todo/:</th><td class="field-body">Récupération de la liste des todos</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">POST /api/todo/:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Création d'un nouveau todo</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">GET /api/todo/&lt;id&gt;:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Récupération du todo avec l'id <em>&lt;id&gt;</em></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">PUT /api/todo/&lt;id&gt;:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Update du todo avec l'id <em>&lt;id&gt;</em></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">DELETE /api/todo/&lt;id&gt;:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Suppression du todo avec l'id <em>&lt;id&gt;</em></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><strong>Partie 02</strong> : <a class="reference external" href="/django-rest-api-02.html">Les filtres</a></p>
</div>

    </div><!-- /.entry-content -->
</section>
                </div>
                </div>
            </div>
        </div>

        <div class="cell shrink footer">
            <footer class="main-footer">
                <div class="grid-container">
                    <div class="grid-x grid-padding-x">
                        
                        <div class="cell auto">
                            
                        </div>

                        <div class="cell auto">
                            <address id="about" class="vcard body">
                                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of
                                <a href="http://python.org">Python</a>.
                            </address>
                        </div>
                        
                        <div class="cell auto">
                            <!-- <div class="grid-y">
                                <div class="cell auto">
                                    <a href="www.linkedin.com/in/marc-aurèle-c-5501b2a5">
                                        <i class="footer-social fab fa-linkedin"></i>
                                    </a>
                                </div>
                            </div> -->
                        </div>

                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- JQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
    <!-- Foundation JS -->
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.3/dist/js/foundation.min.js" integrity="sha256-/PFxCnsMh+nTuM0k3VJCRch1gwnCfKjaP8rJNq5SoBg= sha384-9ksAFjQjZnpqt6VtpjMjlp2S0qrGbcwF/rvrLUg2vciMhwc1UJJeAAOLuJ96w+Nj sha512-UMSn6RHqqJeJcIfV1eS2tPKCjzaHkU/KqgAnQ7Nzn0mLicFxaVhm9vq7zG5+0LALt15j1ljlg8Fp9PT1VGNmDw==" crossorigin="anonymous"></script>
    <script>
        $(document).foundation();
    </script>
</body>
</html>